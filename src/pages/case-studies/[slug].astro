---
import Layout from '../../layouts/Layout.astro';
import { Navbar } from '../../components/Navbar';
import { Footer } from '../../components/Footer';
import { CTA } from '../../components/CTA';
import { caseStudies } from '../../data/caseStudies';
import { Image } from 'astro:assets';

export function getStaticPaths() {
  return caseStudies.map(study => ({
    params: { slug: study.slug },
    props: { study },
  }));
}

const { study } = Astro.props;
---

<Layout>
  <div class="min-h-screen bg-black text-white selection:bg-primary-500/30 selection:text-primary-200 overflow-x-hidden">
    <Navbar client:load />
    
    <main class="pt-32 pb-20">
      {/* Header */}
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-16 text-center">
        <div class="inline-block px-4 py-1.5 rounded-full bg-zinc-900 border border-zinc-800 text-primary-400 text-sm font-medium mb-6">
          {study.category}
        </div>
        <h1 class="text-4xl md:text-6xl font-display font-bold mb-6 text-white">
          {study.subtitle}
        </h1>
        <p class="text-xl text-zinc-400 max-w-3xl mx-auto">
          {study.description}
        </p>
      </div>

      {/* Hero Image */}
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-24">
        <div class="relative rounded-3xl overflow-hidden border border-white/10 shadow-2xl shadow-primary-500/10 aspect-video">
          <Image 
            src={study.image} 
            alt={study.title}
            class="w-full h-full object-cover"
          />
          <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>
        </div>
      </div>

      {/* Content Sections */}
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 space-y-24">
        {/* Detailed Content Sections */}
        {study.detailedContent?.map((section) => (
          <section>
            <h2 class="text-3xl font-display font-bold text-primary-400 mb-6">{section.title}</h2>
            {section.content && (
              <p class="text-lg text-zinc-300 leading-relaxed mb-8">
                {section.content}
              </p>
            )}
            
            {section.items && (
              <div class="space-y-12">
                {section.items.map((item) => (
                  <div class="bg-zinc-900/30 border border-white/5 rounded-2xl p-8 overflow-hidden">
                    <div>
                      <h3 class="text-xl font-bold text-white mb-4">{item.title}</h3>
                      {item.description && (
                        <p class="text-zinc-400 mb-4">{item.description}</p>
                      )}
                      {item.points && (
                        <ul class="space-y-2 mb-8">
                          {item.points.map((point) => (
                            <li class="flex items-start gap-3 text-zinc-300">
                              <div class="mt-2 w-1.5 h-1.5 rounded-full bg-primary-500 shrink-0" />
                              <span>{point}</span>
                            </li>
                          ))}
                        </ul>
                      )}
                    </div>
                    {item.image && (
                      <div class="mt-8 rounded-xl overflow-hidden border border-white/10 shadow-2xl">
                        <Image src={item.image} alt={item.title} class="w-full h-auto object-cover" />
                      </div>
                    )}
                  </div>
                ))}
              </div>
            )}
          </section>
        ))}

        {/* Legacy Content (Fallback if detailedContent is missing) */}
        {!study.detailedContent && (
          <>
            {/* Challenge */}
            <section>
              <h2 class="text-3xl font-display font-bold text-primary-400 mb-6">The Challenge</h2>
              <p class="text-lg text-zinc-300 leading-relaxed">
                {study.content.challenge}
              </p>
            </section>

            {/* Testimonial */}
            {study.content.testimonial && (
              <div class="bg-zinc-900/30 border-l-4 border-primary-500 p-8 md:p-12 rounded-r-2xl my-12">
                <blockquote class="text-xl md:text-2xl font-display font-medium text-white mb-6 italic">
                  "{study.content.testimonial.quote}"
                </blockquote>
                <div class="flex items-center gap-4">
                  <div class="w-12 h-12 rounded-full bg-zinc-800 flex items-center justify-center text-zinc-400 font-bold">
                    {study.content.testimonial.author.charAt(0)}
                  </div>
                  <div>
                    <div class="font-bold text-white">{study.content.testimonial.author}</div>
                    <div class="text-primary-400 text-sm">{study.content.testimonial.role}</div>
                  </div>
                </div>
              </div>
            )}

            {/* Solution */}
            <section>
              <h2 class="text-3xl font-display font-bold text-primary-400 mb-6">Our Solution</h2>
              <p class="text-lg text-zinc-300 leading-relaxed mb-8">
                {study.content.solution}
              </p>
              {study.gallery && study.gallery[0] && (
                 <div class="rounded-2xl overflow-hidden border border-white/10 my-8">
                   <img src={study.gallery[0]} alt="Solution details" class="w-full h-auto" />
                 </div>
              )}
            </section>

            {/* Outcome */}
            <section>
              <h2 class="text-3xl font-display font-bold text-primary-400 mb-6">The Outcome</h2>
              <p class="text-lg text-zinc-300 leading-relaxed mb-8">
                {study.content.outcome}
              </p>
               {study.gallery && study.gallery[1] && (
                 <div class="rounded-2xl overflow-hidden border border-white/10 my-8">
                   <img src={study.gallery[1]} alt="Outcome details" class="w-full h-auto" />
                 </div>
              )}
            </section>
          </>
        )}
      </div>

      <div class="mt-32">
        <CTA client:visible />
      </div>
    </main>
    <Footer client:visible />

  </div>
</Layout>
